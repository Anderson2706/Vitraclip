<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Vitraclip | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { 
            --primary: #255fff; 
            --bg: #05070a; 
            --card: rgba(255, 255, 255, 0.03); 
            --border: rgba(255, 255, 255, 0.08); 
            --text: #94a3b8; 
        }
        * { box-sizing: border-box; }
        body { 
            background: var(--bg); 
            color: white; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            margin: 0; 
            display: flex; 
            min-height: 100vh;
            background-image: radial-gradient(circle at top right, rgba(37, 95, 255, 0.1), transparent 50%);
            background-attachment: fixed;
        }
        aside { 
            width: 260px; 
            background: rgba(8, 10, 15, 0.7); 
            border-right: 1px solid var(--border); 
            position: fixed; 
            height: 100vh; 
            backdrop-filter: blur(20px); 
            z-index: 100; 
            display: flex;
            flex-direction: column;
        }
        .nav-item { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            padding: 14px 20px; 
            color: var(--text); 
            text-decoration: none; 
            margin: 5px 15px; 
            border-radius: 12px; 
            transition: 0.3s; 
            border: 1px solid transparent;
        }
        .nav-item.active { 
            background: rgba(37, 95, 255, 0.1); 
            color: var(--primary); 
            font-weight: 700; 
            border-color: rgba(37, 95, 255, 0.2); 
        }
        main { 
            margin-left: 260px; 
            padding: 60px; 
            width: 100%; 
            position: relative;
            z-index: 1;
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 40px; 
        }
        .stat-card { 
            background: var(--card); 
            border: 1px solid var(--border); 
            padding: 30px; 
            border-radius: 28px; 
            position: relative;
            transition: 0.3s;
        }
        .stat-card:hover {
            border-color: rgba(37, 95, 255, 0.3);
            background: rgba(255, 255, 255, 0.05);
        }
        .stat-card small { 
            color: var(--text); 
            font-weight: 700; 
            font-size: 11px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
        }
        .stat-card h2 { 
            margin: 12px 0 0 0; 
            font-size: 32px; 
            font-weight: 800; 
        }
        .content-box { 
            background: var(--card); 
            border: 1px solid var(--border); 
            border-radius: 30px; 
            padding: 30px; 
        }
        .item-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 20px; 
            background: rgba(255,255,255,0.02); 
            border-radius: 20px; 
            margin-bottom: 12px; 
            border: 1px solid transparent; 
            transition: 0.3s; 
        }
        .item-row:hover { 
            background: rgba(37, 95, 255, 0.05); 
            border-color: var(--primary); 
        }
        .badge { 
            background: rgba(37, 95, 255, 0.1); 
            color: var(--primary); 
            padding: 6px 12px; 
            border-radius: 10px; 
            font-size: 10px; 
            font-weight: 800; 
            text-transform: uppercase;
        }
        #btn-ver-tudo {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }
        #btn-ver-tudo:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
    </style>
</head>
<body>
    <aside>
        <div style="padding: 45px 35px;">
            <h2 style="margin:0; font-weight:900; letter-spacing:-1.5px; font-size: 26px;">vitraclip<span style="color:var(--primary)">.</span></h2>
        </div>
        <nav>
            <a href="dashboard.html" class="nav-item active"><i data-lucide="layout-grid"></i> Dashboard</a>
            <a href="pagar.html" class="nav-item"><i data-lucide="wallet"></i> Contas a Pagar</a>
            <a href="alertas.html" class="nav-item"><i data-lucide="bell"></i> Alertas</a>
            <a href="estimativa.html" class="nav-item"><i data-lucide="zap"></i> Estimativa</a>
            <a href="relatorio.html" class="nav-item"><i data-lucide="pie-chart"></i> Relatório</a>
            <a href="perfil.html" class="nav-item"><i data-lucide="user"></i> Perfil</a>
            <div style="margin-top: auto; padding: 20px 15px; margin-bottom: 20px;">
                <a href="scanner.html" class="nav-item" style="border: 1px dashed var(--primary); color: var(--primary); justify-content: center; background: rgba(37, 95, 255, 0.05);">
                    <i data-lucide="scan"></i> NOVO SCAN
                </a>
            </div>
        </nav>
    </aside>
    <main>
        <header style="margin-bottom: 50px;">
            <h1 style="margin:0; font-size: 38px; font-weight: 800; letter-spacing: -1px;">Painel de Controle</h1>
            <p style="color: var(--text); margin-top: 8px; font-size: 16px;">Dados consolidados da extração Vision Neural.</p>
        </header>
        <div class="stats-grid">
            <div class="stat-card">
                <small>Total Processado</small>
                <h2 id="card-total">R$ 0,00</h2>
            </div>
            <div class="stat-card">
                <small>Documentos Lidos</small>
                <h2 id="card-qty">0</h2>
            </div>
            <div class="stat-card">
                <small>Média por Nota</small>
                <h2 id="card-media">R$ 0,00</h2>
            </div>
        </div>
        <div class="content-box">
            <h3 style="margin:0 0 25px 0; font-size: 20px;">Histórico de Capturas</h3>
            <div id="container-lista"></div>
            <button id="btn-ver-tudo" style="display: none;">Ver Histórico Completo</button>
        </div>
    </main>
 <script>
    lucide.createIcons();
    let mostrarTodos = false;

    function formatarParaNumero(valorMix) {
        if (typeof valorMix === 'number') return valorMix;
        if (!valorMix) return 0;
        let limpo = valorMix.toString().replace(/[^\d,.-]/g, '');
        if (limpo.includes(',') && limpo.includes('.')) {
            limpo = limpo.replace(/\./g, '').replace(',', '.');
        } else {
            limpo = limpo.replace(',', '.');
        }
        return parseFloat(limpo) || 0;
    }

    function render() {
        // Puxa o banco de dados atualizado
        const db = JSON.parse(localStorage.getItem('vitraclip_scans') || "[]");
        const lista = document.getElementById('container-lista');
        const btnVerTudo = document.getElementById('btn-ver-tudo');
        lista.innerHTML = '';
        
        // FILTRO: No Dashboard, vamos mostrar apenas o que NÃO foi pago ainda
        // Para que os números batam com a tela de "Contas a Pagar"
        const dadosAtivos = db.filter(item => item.status !== 'pago');

        let soma = 0;
        if (dadosAtivos.length === 0) {
            lista.innerHTML = '<p style="color:var(--text); text-align:center; padding:40px;">Tudo limpo! Nenhuma pendência ativa.</p>';
            document.getElementById('card-total').innerText = "R$ 0,00";
            document.getElementById('card-qty').innerText = "0";
            document.getElementById('card-media').innerText = "R$ 0,00";
            return;
        }

        const limite = 10;
        const itensParaExibir = mostrarTodos ? dadosAtivos : dadosAtivos.slice(0, limite);

        dadosAtivos.forEach((item, index) => {
            const num = formatarParaNumero(item.valor);
            soma += num; // Soma apenas o que não está pago

            if (index < itensParaExibir.length) {
                lista.innerHTML += `
                    <div class="item-row">
                        <div>
                            <div style="font-weight:700; font-size:16px;">${item.empresa || 'Doc. Identificado'}</div>
                            <div style="font-size:12px; color:var(--text); margin-top:5px;">${item.data} • <span style="color:var(--primary)">Pendente</span></div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:800; color:var(--primary); font-size:18px;">R$ ${num.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                            <span class="badge">Sincronizado</span>
                        </div>
                    </div>`;
            }
        });

        // Gerencia o botão de "Ver Tudo" baseado nos dados filtrados
        if (dadosAtivos.length > limite && !mostrarTodos) {
            btnVerTudo.style.display = 'block';
            btnVerTudo.innerText = `Ver todos os ${dadosAtivos.length} pendentes`;
        } else {
            btnVerTudo.style.display = 'none';
        }

        // Atualiza Cards com os valores sincronizados (apenas pendentes)
        document.getElementById('card-total').innerText = soma.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        document.getElementById('card-qty').innerText = dadosAtivos.length;
        document.getElementById('card-media').innerText = (soma / (dadosAtivos.length || 1)).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        
        lucide.createIcons();
    }

    document.getElementById('btn-ver-tudo').onclick = () => {
        mostrarTodos = true;
        render();
    };

    // Recarrega sempre que a página ganhar foco (caso o usuário tenha pago em outra aba)
    window.onfocus = render;
    window.onload = render;
</script>
</body>
</html>
